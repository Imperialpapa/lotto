<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>로또 오라클</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root{
            --bg:#edf1fb;--card:#fff;--surface:#f4f6fd;--border:rgba(0,0,0,.06);
            --pri:#5b6ef5;--pri-lt:#8b97ff;--pri-pale:#e8ebff;
            --pink:#ff6b9d;--orange:#ff9a56;--green:#2dd4a8;--cyan:#38c9ff;
            --t1:#1a1d2e;--t2:#484b60;--t3:#888ba0;
        }
        *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
        body{
            font-family:'Noto Sans KR',-apple-system,sans-serif;
            background:var(--bg);color:var(--t1);
            min-height:100%;min-height:100dvh;
            -webkit-font-smoothing:antialiased;
            -webkit-tap-highlight-color:transparent;
            user-select:none;-webkit-user-select:none;
        }
        body::before,body::after{content:'';position:fixed;border-radius:50%;filter:blur(80px);opacity:.45;pointer-events:none;z-index:0;animation:blob 14s ease-in-out infinite alternate}
        body::before{width:55vw;height:55vw;top:-12%;left:-12%;background:radial-gradient(circle,rgba(91,110,245,.28),transparent 70%)}
        body::after{width:50vw;height:50vw;bottom:-8%;right:-12%;background:radial-gradient(circle,rgba(255,107,157,.22),transparent 70%);animation-delay:-7s;animation-direction:alternate-reverse}
        @keyframes blob{0%{transform:translate(0,0) scale(1)}100%{transform:translate(25px,-18px) scale(1.08)}}
        #confetti{position:fixed;inset:0;pointer-events:none;z-index:100}

        /* ===== LAYOUT (natural scroll) ===== */
        .app{
            position:relative;z-index:1;
            min-height:100%;min-height:100dvh;
            display:flex;flex-direction:column;
            width:100%;max-width:100%;margin:0;
            padding:0;
            padding-bottom:env(safe-area-inset-bottom,0);
        }
        .sp-bot{flex:1;min-height:8px}

        /* ===== HEADER ===== */
        .hdr{text-align:center;padding:45px 0 20px;flex-shrink:0}
        .hdr h1{
            font-family:'Black Han Sans',sans-serif;
            font-size:clamp(3.5rem,18vw,5.5rem);
            background:linear-gradient(135deg,var(--pri),var(--pink),var(--orange));
            -webkit-background-clip:text;-webkit-text-fill-color:transparent;
            background-clip:text;letter-spacing:1px;line-height:1;
            animation:shimmer 4s ease-in-out infinite;background-size:200% 200%;
        }
        @keyframes shimmer{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
        .hdr .sub{font-size:1.05rem;color:var(--t3);margin-top:8px;letter-spacing:4px;font-weight:400}

        /* ===== CATEGORY TABS ===== */
        .cats{
            display:flex;gap:14px;flex-shrink:0;
            overflow-x:auto;scrollbar-width:none;
            padding:15px 6px;
        }
        .cats::-webkit-scrollbar{display:none}
        .cat{
            flex-shrink:0;padding:20px 32px;
            border-radius:36px;border:1.5px solid var(--border);
            background:var(--card);color:var(--t2);
            font-size:1.25rem;font-weight:600;
            font-family:'Noto Sans KR',sans-serif;
            cursor:pointer;white-space:nowrap;
            transition:all .25s cubic-bezier(.34,1.56,.64,1);
            box-shadow:0 3px 10px rgba(91,110,245,.1);
        }
        .cat.active{
            background:linear-gradient(135deg,var(--pri),var(--pri-lt));
            color:#fff;border-color:transparent;
            box-shadow:0 6px 22px rgba(91,110,245,.35);
            transform:scale(1.05);
        }
        .cat:active{transform:scale(.95)}

        /* ===== CONTROLS ===== */
        .ctrl{
            flex-shrink:0;
            background:var(--card);
            border-radius:0;padding:30px 10px;
            box-shadow:0 6px 24px rgba(91,110,245,.12);
            margin:15px 0;border-top:1px solid var(--border);border-bottom:1px solid var(--border);
        }
        .pk-row{display:flex;gap:12px}
        .pk-wrap{flex:1;min-width:0}
        .pk-wrap.sm{flex:0 0 120px}
        .pk-lbl{font-size:1.15rem;color:var(--t3);margin-bottom:12px;font-weight:600;padding-left:4px;letter-spacing:1px}
        .pk-box{
            position:relative;height:clamp(350px,55vh,800px);overflow:hidden;
            background:var(--surface);border-radius:20px;border:1px solid var(--border);
        }
        .pk-hl{
            position:absolute;top:50%;left:8px;right:8px;
            height:80px;transform:translateY(-50%);
            background:linear-gradient(90deg,var(--pri-pale),rgba(91,110,245,.04));
            border-radius:18px;pointer-events:none;
            border:2px solid rgba(91,110,245,.2);
        }
        .pk-scroll{height:100%;overflow-y:scroll;scroll-snap-type:y mandatory;-webkit-overflow-scrolling:touch}
        .pk-scroll::-webkit-scrollbar{display:none}
        .pk-item{
            height:80px;display:flex;align-items:center;justify-content:center;
            scroll-snap-align:center;font-size:1.4rem;color:var(--t3);
            transition:all .15s ease;cursor:pointer;padding:0 6px;
        }
        .pk-item.active{color:var(--pri);font-weight:800;font-size:1.8rem}
        .m-desc{
            margin-top:20px;padding:20px 25px;
            background:var(--pri-pale);border-radius:18px;
            border-left:8px solid var(--pri);
            font-size:1.2rem;color:var(--t2);line-height:1.5;
        }

        /* ===== GENERATE BUTTON ===== */
        .gen{
            flex-shrink:0;display:block;width:100%;
            padding:38px;margin:15px 0;border:none;border-radius:0;
            background:linear-gradient(135deg,var(--pri),var(--pri-lt),var(--cyan));
            background-size:200% 200%;color:#fff;
            font-family:'Black Han Sans',sans-serif;
            font-size:clamp(2.4rem,11vw,3.5rem);letter-spacing:12px;
            cursor:pointer;position:relative;overflow:hidden;
            box-shadow:0 10px 40px rgba(91,110,245,.4);
            animation:pulse 3s ease-in-out infinite;transition:all .2s ease;
        }
        @keyframes pulse{
            0%,100%{background-position:0% 50%;box-shadow:0 6px 28px rgba(91,110,245,.35)}
            50%{background-position:100% 50%;box-shadow:0 6px 34px rgba(56,201,255,.35)}
        }
        .gen::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent);transition:left .5s ease}
        .gen:active{transform:scale(.96);box-shadow:0 3px 14px rgba(91,110,245,.3)}
        .gen.done{background:linear-gradient(135deg,var(--green),#1ad4a0)!important;box-shadow:0 6px 28px rgba(45,212,168,.4)!important;animation:none}
        .gen.shimmer::before{left:100%}

        /* ===== RESULTS (숨겨졌다가 생성 시 나타남) ===== */
        .res{
            overflow:hidden;
            border-radius:0;
            transition:opacity .3s ease, margin .3s ease;
        }
        .res.empty{max-height:0;opacity:0;margin:0}
        .res.has-results{
            opacity:1;margin:0 0 15px;
            background:var(--card);
            box-shadow:0 6px 30px rgba(91,110,245,.12);
            border-top:1px solid var(--border);border-bottom:1px solid var(--border);
        }
        .res-top{
            padding:18px 22px;display:flex;
            justify-content:space-between;align-items:center;
            border-bottom:1px solid var(--border);background:var(--surface);
        }
        .res-top span{font-size:1.15rem;color:var(--t2);font-weight:700;letter-spacing:1px}
        .clr-btn{
            background:var(--card);border:1px solid var(--border);
            color:var(--t3);font-size:1.05rem;padding:10px 22px;
            border-radius:16px;cursor:pointer;
            font-family:'Noto Sans KR',sans-serif;font-weight:600;
            transition:all .2s;box-shadow:0 2px 6px rgba(0,0,0,.04);
        }
        .clr-btn:active{background:#fee;color:var(--pink);border-color:var(--pink)}
        .res-scroll{
            padding:18px 10px;
        }
        .res-scroll::-webkit-scrollbar{width:4px}
        .res-scroll::-webkit-scrollbar-track{background:transparent}
        .res-scroll::-webkit-scrollbar-thumb{background:rgba(91,110,245,.15);border-radius:2px}

        /* ===== SET CARD ===== */
        .set{
            padding:25px 12px;margin-bottom:18px;
            background:var(--surface);border-radius:0;
            border-top:1px solid var(--border);border-bottom:1px solid var(--border);
            animation:setIn .4s cubic-bezier(.34,1.56,.64,1) backwards;
            box-shadow:0 3px 14px rgba(91,110,245,.08);
        }
        @keyframes setIn{from{opacity:0;transform:translateY(14px) scale(.95)}to{opacity:1;transform:none}}
        .set-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
        .set-top strong{font-size:1.3rem;color:var(--pri);font-weight:800}
        .set-top .tag{font-size:.95rem;color:var(--t3);background:var(--card);padding:6px 16px;border-radius:14px;border:1px solid var(--border);font-weight:600}

        /* ===== BALLS ===== */
        .balls{display:flex;justify-content:center;gap:clamp(8px,3vw,20px)}
        .b{
            width:clamp(70px,18vw,110px);height:clamp(70px,18vw,110px);
            border-radius:50%;display:inline-flex;
            align-items:center;justify-content:center;
            font-weight:900;font-size:clamp(1.6rem,7vw,2.5rem);
            color:#fff;position:relative;
            text-shadow:0 1px 2px rgba(0,0,0,.2);
            animation:bPop .5s cubic-bezier(.34,1.56,.64,1) backwards;
            transition:transform .15s ease;
        }
        .b:active{transform:scale(1.18) rotate(-5deg)}
        .b::after{content:'';position:absolute;top:14%;left:20%;width:24%;height:18%;background:rgba(255,255,255,.5);border-radius:50%;transform:rotate(-30deg)}
        @keyframes bPop{0%{opacity:0;transform:scale(0) rotate(-40deg)}50%{opacity:1;transform:scale(1.2) rotate(8deg)}70%{transform:scale(.9) rotate(-3deg)}100%{transform:scale(1) rotate(0)}}
        .b[data-range="1"]{background:linear-gradient(145deg,#ffd43b,#ff9f43);box-shadow:0 5px 20px rgba(255,159,67,.4),inset 0 2px 4px rgba(255,255,255,.3)}
        .b[data-range="2"]{background:linear-gradient(145deg,#74b9ff,#3b82f6);box-shadow:0 5px 20px rgba(59,130,246,.4),inset 0 2px 4px rgba(255,255,255,.3)}
        .b[data-range="3"]{background:linear-gradient(145deg,#ff7eb3,#ff3d71);box-shadow:0 5px 20px rgba(255,61,113,.35),inset 0 2px 4px rgba(255,255,255,.3)}
        .b[data-range="4"]{background:linear-gradient(145deg,#b18cff,#8b5cf6);box-shadow:0 5px 20px rgba(139,92,246,.4),inset 0 2px 4px rgba(255,255,255,.3)}
        .b[data-range="5"]{background:linear-gradient(145deg,#6ee7b7,#10b981);box-shadow:0 5px 20px rgba(16,185,129,.4),inset 0 2px 4px rgba(255,255,255,.3)}

        /* ===== SPONSOR ===== */
        .spon{flex-shrink:0;padding:25px 10px;text-align:center}
        .spon-t{font-size:1rem;color:var(--t3);font-weight:700}
        .spon-d{font-size:.9rem;color:var(--t3);opacity:.7;margin-top:2px}

        /* ===== RESPONSIVE ===== */
        @media (min-width:500px){.app{width:100%;max-width:100%;margin:0;padding:0}.b{width:100px;height:100px;font-size:2.2rem}}
        @media (max-width:360px){
            .hdr h1{font-size:3.2rem}
            .cat{padding:16px 24px;font-size:1.1rem}
            .pk-box{height:clamp(280px,48vh,600px)}
            .pk-item{height:72px;font-size:1.25rem}.pk-item.active{font-size:1.5rem}.pk-hl{height:72px}
            .b{width:60px;height:60px;font-size:1.4rem}.balls{gap:8px}
            .m-desc{font-size:1.1rem}
        }
        @media (max-height:600px) and (orientation:landscape){
            .hdr{padding:4px 6px 2px}.hdr h1{font-size:1.3rem}.hdr .sub{display:none}
            .sp-bot{flex:.2}
            .ctrl{padding:8px;margin:4px 6px}.pk-box{height:90px}.pk-item{height:36px}.pk-hl{height:36px}
            .gen{padding:12px;margin:4px 6px}
            .res.has-results{}
        }
        *{scrollbar-width:thin;scrollbar-color:rgba(91,110,245,.12) transparent}
    </style>
</head>
<body>
<canvas id="confetti"></canvas>
<div class="app">
    <header class="hdr">
        <h1>로또 오라클</h1>
    </header>

    <div class="cats">
        <button class="cat active" data-cat="basic">기본</button>
        <button class="cat" data-cat="frequency">빈도/간격</button>
        <button class="cat" data-cat="pattern">패턴</button>
        <button class="cat" data-cat="advanced">고급 통계</button>
        <button class="cat" data-cat="filter">필터링</button>
    </div>

    <div class="ctrl">
        <div class="pk-row">
            <div class="pk-wrap">
                <div class="pk-lbl">생성 방법</div>
                <div class="pk-box">
                    <div class="pk-hl"></div>
                    <div class="pk-scroll" id="methodPicker"></div>
                </div>
            </div>
            <div class="pk-wrap sm">
                <div class="pk-lbl">세트</div>
                <div class="pk-box">
                    <div class="pk-hl"></div>
                    <div class="pk-scroll" id="setCountPicker"></div>
                </div>
            </div>
        </div>
        <div class="m-desc" id="mDesc">방법을 선택하세요</div>
    </div>

    <button class="gen" id="genBtn">번호 생성</button>

    <!-- 결과: 비어있으면 숨김, 생성하면 슬라이드로 나타남 -->
    <div class="res empty" id="resArea">
        <div class="res-top">
            <span>생성 결과</span>
            <button class="clr-btn" id="clrBtn">초기화</button>
        </div>
        <div class="res-scroll" id="resScroll"></div>
    </div>

    <div class="sp-bot"></div>

    <div class="spon">
        <div class="spon-t">후원 계좌: 카카오뱅크 3333-35-8084358</div>
        <div class="spon-d">에듀크립트 솔루션즈</div>
    </div>
</div>

<script>
// ===== CONFETTI =====
const Confetti=(()=>{const cv=document.getElementById('confetti'),cx=cv.getContext('2d');let ps=[],raf=null;const cs=['#5b6ef5','#ff6b9d','#ff9a56','#2dd4a8','#38c9ff','#ffd43b','#b18cff'];function rz(){cv.width=innerWidth;cv.height=innerHeight}addEventListener('resize',rz);rz();function mk(n=60){for(let i=0;i<n;i++)ps.push({x:Math.random()*cv.width,y:-10-Math.random()*40,w:4+Math.random()*6,h:3+Math.random()*4,c:cs[Math.random()*cs.length|0],vy:2+Math.random()*3,vx:(Math.random()-.5)*3,rot:Math.random()*360,rv:(Math.random()-.5)*8,life:1});if(!raf)ani()}function ani(){cx.clearRect(0,0,cv.width,cv.height);ps=ps.filter(p=>p.life>0);if(!ps.length){raf=null;return}ps.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.vy+=.04;p.rot+=p.rv;p.life-=.006;cx.save();cx.translate(p.x,p.y);cx.rotate(p.rot*Math.PI/180);cx.globalAlpha=Math.min(1,p.life*2);cx.fillStyle=p.c;cx.fillRect(-p.w/2,-p.h/2,p.w,p.h);cx.restore()});raf=requestAnimationFrame(ani)}return{fire:mk}})();

// ===== HAPTIC & SOUND =====
const Haptic={light(){try{navigator.vibrate?.(8)}catch(e){}},medium(){try{navigator.vibrate?.(15)}catch(e){}},heavy(){try{navigator.vibrate?.(30)}catch(e){}},tick(){try{navigator.vibrate?.(4)}catch(e){}},success(){try{navigator.vibrate?.([12,40,12])}catch(e){}}};
const Sound=(()=>{let ctx=null;function gc(){if(!ctx){try{ctx=new(AudioContext||webkitAudioContext)}catch(e){return null}}if(ctx.state==='suspended')ctx.resume();return ctx}function p(f,t,d,v=.12){const c=gc();if(!c)return;const o=c.createOscillator(),g=c.createGain();o.type=t;o.frequency.value=f;g.gain.setValueAtTime(v,c.currentTime);g.gain.exponentialRampToValueAtTime(.001,c.currentTime+d);o.connect(g);g.connect(c.destination);o.start(c.currentTime);o.stop(c.currentTime+d)}return{tick(){p(2200,'sine',.03,.05)},click(){p(1400,'sine',.05,.07)},select(){p(880,'sine',.07,.09);setTimeout(()=>p(1175,'sine',.07,.07),50)},generate(){p(523,'sine',.1,.1);setTimeout(()=>p(659,'sine',.1,.09),70);setTimeout(()=>p(784,'sine',.12,.1),140);setTimeout(()=>p(1047,'sine',.2,.12),220)},ballPop(i){setTimeout(()=>p(700+i*130,'sine',.06,.06),i*55)},clear(){p(500,'triangle',.12,.06)},success(){p(784,'sine',.12,.1);setTimeout(()=>p(988,'sine',.12,.1),90);setTimeout(()=>p(1319,'sine',.25,.12),180)}}})();

// ===== DATA =====
const HISTORY=[[3,12,18,24,30,43],[2,7,12,22,26,37],[7,11,20,30,39,43],[2,3,14,28,37,45],[6,7,14,18,29,44],[2,6,10,23,25,45],[3,9,17,19,43,44],[7,10,14,18,37,43],[1,4,7,15,38,45],[2,8,25,27,37,39],[13,19,22,28,34,44],[7,8,20,28,33,45],[2,15,19,24,34,43],[4,9,11,20,28,34],[6,14,17,27,30,42],[7,10,16,18,28,45],[6,14,16,21,22,43],[5,10,11,17,28,34],[9,12,20,23,34,40],[6,7,22,32,37,40],[3,5,21,24,26,42],[16,19,21,25,26,44],[6,8,14,22,30,44],[4,12,14,28,32,33],[7,11,24,28,35,45],[2,9,16,36,38,42],[5,12,25,26,33,44],[8,15,17,19,43,44],[7,10,22,28,34,40],[1,5,22,25,27,32],[1,12,20,25,30,45],[3,7,15,29,40,44],[3,11,15,27,29,45],[6,17,19,21,36,43],[1,2,11,28,36,45],[6,14,25,27,37,45],[3,10,23,29,33,45],[3,5,17,23,24,35],[3,15,23,24,25,44],[9,12,13,19,37,45],[1,3,23,24,27,40],[4,11,16,30,33,44],[7,9,14,18,22,28],[4,12,17,28,38,45],[6,10,16,28,34,44],[7,15,16,21,29,44],[6,9,11,17,24,45],[1,7,10,22,26,43],[1,2,4,7,36,45],[5,6,11,19,28,43],[3,10,13,22,42,45],[8,10,18,20,24,43],[6,13,27,30,39,40],[6,12,19,22,31,45],[5,6,7,16,17,28],[5,9,13,23,39,45],[3,4,8,20,34,44],[4,9,28,32,38,42],[8,11,13,28,36,42],[2,3,22,27,28,41],[7,12,13,18,29,45],[4,14,16,21,35,44],[1,10,18,31,33,44],[3,13,16,18,32,45],[5,9,27,33,35,43],[3,10,11,15,20,30],[6,13,16,22,43,45],[3,10,11,16,36,44],[3,13,20,28,33,45],[1,3,8,15,34,44],[6,11,16,19,22,27],[4,7,12,14,22,38],[7,8,12,21,30,40],[12,21,24,30,37,43],[2,4,10,23,28,41],[3,5,6,10,22,26],[2,11,15,16,27,34],[4,16,17,21,29,44],[3,7,10,12,27,41],[4,6,7,37,38,43],[5,8,18,21,24,36],[3,5,15,16,33,45],[4,5,17,18,31,43],[2,8,10,25,29,45],[6,11,32,34,40,45],[3,7,17,21,22,44],[2,5,7,10,13,44],[4,7,17,18,38,43],[2,14,20,27,39,42],[1,5,20,25,28,45],[1,3,7,28,35,42],[5,11,20,33,39,43],[4,8,13,22,28,44],[9,12,14,26,36,45],[7,11,13,15,22,44],[3,6,7,14,27,35],[2,6,12,19,22,43],[4,7,9,14,21,44],[3,12,15,24,30,44],[6,8,23,27,38,43],[2,5,10,17,24,30],[7,11,22,33,39,45]];

// ===== STATS =====
const Stats={
    getFrequencies(){const f=new Array(46).fill(0);HISTORY.forEach(d=>d.forEach(n=>f[n]++));return f},
    getGaps(){const g=new Array(46).fill(HISTORY.length);for(let i=0;i<HISTORY.length;i++)HISTORY[i].forEach(n=>{if(g[n]===HISTORY.length)g[n]=i});return g},
    getPairFreq(){const p={};HISTORY.forEach(d=>{for(let i=0;i<d.length;i++)for(let j=i+1;j<d.length;j++){const k=d[i]+','+d[j];p[k]=(p[k]||0)+1}});return p},
    getMovingAvg(w=15){const s=new Array(46).fill(0);HISTORY.slice(0,w).forEach((d,i)=>{const wt=(w-i)/w;d.forEach(n=>s[n]+=wt)});return s},
    calcAC(n){const d=new Set();for(let i=0;i<n.length;i++)for(let j=i+1;j<n.length;j++)d.add(Math.abs(n[i]-n[j]));return d.size-(n.length-1)},
    entropyScore(n){const s=[...n].sort((a,b)=>a-b);let sc=0;const r=[0,0,0,0,0];s.forEach(v=>{if(v<=10)r[0]++;else if(v<=20)r[1]++;else if(v<=30)r[2]++;else if(v<=40)r[3]++;else r[4]++});sc+=r.filter(x=>x>0).length*2;const od=s.filter(v=>v%2===1).length;sc+=(3-Math.abs(3-od))*1.5;for(let i=1;i<s.length;i++)sc+=Math.min(s[i]-s[i-1],10)*.3;return sc},
    isValidPattern(n){const s=[...n].sort((a,b)=>a-b);const od=s.filter(v=>v%2===1).length;if(od===0||od===6)return false;if(new Set(s.map(v=>Math.floor((v-1)/10))).size===1)return false;let c=1;for(let i=1;i<s.length;i++){if(s[i]===s[i-1]+1){c++;if(c>=4)return false}else c=1}const sm=s.reduce((a,b)=>a+b,0);return sm>=60&&sm<=220},
    weightedPick(w,cnt){const res=new Set(),av=[];for(let i=1;i<=45;i++)if(w[i]>0)av.push({n:i,w:w[i]});while(res.size<cnt&&av.length>0){const tot=av.reduce((s,a)=>s+a.w,0);let r=Math.random()*tot;for(let k=0;k<av.length;k++){r-=av[k].w;if(r<=0){res.add(av[k].n);av.splice(k,1);break}}}while(res.size<cnt){const n=Math.floor(Math.random()*45)+1;if(!res.has(n))res.add(n)}return[...res]}
};

// ===== GENERATORS =====
const G={
    '90':{name:'90번 방법',desc:'2~90 난수를 2로 나눈 뒤 올림하여 번호를 생성합니다.',fn(){const s=new Set();while(s.size<6)s.add(Math.ceil((Math.floor(Math.random()*89)+2)/2));return[...s]}},
    random:{name:'랜덤',desc:'1~45에서 완전 무작위로 6개를 선택합니다.',fn(){const s=new Set();while(s.size<6)s.add(Math.floor(Math.random()*45)+1);return[...s]}},
    oddeven:{name:'홀짝 균형',desc:'홀수 3개 + 짝수 3개. 역대 가장 빈출하는 비율입니다.',fn(){const o=new Set(),e=new Set();while(o.size<3){const n=Math.floor(Math.random()*23)*2+1;if(n<=45)o.add(n)}while(e.size<3)e.add(Math.floor(Math.random()*22)*2+2);return[...o,...e]}},
    highlow:{name:'고저 균형',desc:'저번호(1~22) 3개 + 고번호(23~45) 3개를 선택합니다.',fn(){const l=new Set(),h=new Set();while(l.size<3)l.add(Math.floor(Math.random()*22)+1);while(h.size<3)h.add(Math.floor(Math.random()*23)+23);return[...l,...h]}},
    section:{name:'번호대 분산',desc:'5개 구간에서 1개씩 + 랜덤 1개를 뽑습니다.',fn(){const sec=[[1,9],[10,19],[20,29],[30,39],[40,45]],u=new Set(),n=[];sec.forEach(([a,b])=>{let v;do{v=Math.floor(Math.random()*(b-a+1))+a}while(u.has(v));u.add(v);n.push(v)});let x;do{x=Math.floor(Math.random()*45)+1}while(u.has(x));n.push(x);return n}},
    frequency:{name:'빈도 분석',desc:'역대 당첨에서 자주 출현한 핫 넘버에 가중치를 둡니다.',fn(){return Stats.weightedPick(Stats.getFrequencies(),6)}},
    gap:{name:'간격 분석',desc:'오랫동안 출현하지 않은 콜드 넘버를 우선 선택합니다.',fn(){const g=Stats.getGaps(),w=new Array(46).fill(0);for(let i=1;i<=45;i++)w[i]=g[i]+1;return Stats.weightedPick(w,6)}},
    association:{name:'연관 규칙',desc:'자주 함께 출현하는 번호 쌍 기반으로 조합을 구성합니다.',fn(){const p=Stats.getPairFreq(),s=Object.entries(p).sort((a,b)=>b[1]-a[1]),r=new Set();for(const[k]of s){if(r.size>=6)break;const[a,b]=k.split(',').map(Number);if(r.size<5){r.add(a);r.add(b)}else if(!r.has(a))r.add(a);else if(!r.has(b))r.add(b)}while(r.size<6)r.add(Math.floor(Math.random()*45)+1);return[...r].slice(0,6)}},
    poisson:{name:'확률 분포',desc:'포아송 분포 기반으로 과소 출현 번호를 우선 선택합니다.',fn(){const f=Stats.getFrequencies(),ex=HISTORY.length*6/45,w=new Array(46).fill(0);for(let i=1;i<=45;i++)w[i]=Math.max(.1,ex-f[i]+ex);return Stats.weightedPick(w,6)}},
    movingavg:{name:'이동평균',desc:'최근 15회차 가중 이동평균으로 상승 추세 번호를 선택합니다.',fn(){const r=Stats.getMovingAvg(15),o=Stats.getMovingAvg(30),t=new Array(46).fill(0);for(let i=1;i<=45;i++)t[i]=Math.max(.1,r[i]*2-o[i]+1);return Stats.weightedPick(t,6)}},
    sumrange:{name:'합계 범위',desc:'합계가 최빈 구간(100~175)에 해당하는 조합만 선택합니다.',fn(){for(let a=0;a<5000;a++){const s=new Set();while(s.size<6)s.add(Math.floor(Math.random()*45)+1);const arr=[...s];if(arr.reduce((a,b)=>a+b,0)>=100&&arr.reduce((a,b)=>a+b,0)<=175)return arr}return G.random.fn()}},
    montecarlo:{name:'몬테카를로',desc:'10,000회 시뮬레이션으로 역대 분포와 가장 유사한 조합 선택.',fn(){const f=Stats.getFrequencies(),tot=HISTORY.length*6,id=f.map(v=>v/tot);let best=null,bs=Infinity;for(let t=0;t<10000;t++){const s=new Set();while(s.size<6)s.add(Math.floor(Math.random()*45)+1);const a=[...s];let sc=0;a.forEach(n=>sc+=Math.abs(id[n]-1/45));const sm=a.reduce((x,y)=>x+y,0);if(sm<100||sm>175)sc+=.5;const ac=Stats.calcAC(a);if(ac<7||ac>10)sc+=.3;if(sc<bs){bs=sc;best=a}}return best||G.random.fn()}},
    entropy:{name:'엔트로피 기반',desc:'정보 엔트로피(다양성)를 최대화하는 분산 전략입니다.',fn(){let best=null,bs=-Infinity;for(let t=0;t<5000;t++){const s=new Set();while(s.size<6)s.add(Math.floor(Math.random()*45)+1);const a=[...s],sc=Stats.entropyScore(a);if(sc>bs){bs=sc;best=a}}return best||G.random.fn()}},
    elimination:{name:'배제 전략',desc:'올홀, 올짝, 연속4+, 극단합 등 비현실 패턴을 배제합니다.',fn(){for(let a=0;a<10000;a++){const s=new Set();while(s.size<6)s.add(Math.floor(Math.random()*45)+1);if(Stats.isValidPattern([...s]))return[...s]}return G.random.fn()}},
    acvalue:{name:'AC값 최적화',desc:'AC값 7~10 범위 조합만 선택. 역대 당첨의 80%가 이 범위.',fn(){for(let a=0;a<10000;a++){const s=new Set();while(s.size<6)s.add(Math.floor(Math.random()*45)+1);const arr=[...s].sort((a,b)=>a-b);if(Stats.calcAC(arr)>=7&&Stats.calcAC(arr)<=10&&Stats.isValidPattern(arr))return arr}return G.random.fn()}}
};

// ===== CATEGORIES =====
const CATS={basic:['90','random','oddeven','highlow','section'],frequency:['frequency','gap','movingavg'],pattern:['association','oddeven','section'],advanced:['poisson','montecarlo','entropy','acvalue'],filter:['sumrange','elimination','acvalue']};
let curCat='basic',selMethod='90',selSets=5;

// ===== PICKER =====
function createPicker(id,opts,defIdx,onSelect){
    const el=document.getElementById(id);
    const ih=window.innerWidth<=360?72:80;
    const cnt=opts.length,cl=Math.min(3,cnt);
    let val=opts[defIdx].value,scrolling=false,lastVal=null;
    el.innerHTML='';
    const mk=(o,ri,clone)=>{const d=document.createElement('div');d.className='pk-item'+(clone?' clone':'');d.dataset.value=o.value;d.dataset.ri=ri;d.textContent=o.label;d.style.height=ih+'px';return d};
    for(let i=cnt-cl;i<cnt;i++)el.appendChild(mk(opts[i],i,true));
    opts.forEach((o,i)=>el.appendChild(mk(o,i,false)));
    for(let i=0;i<cl;i++)el.appendChild(mk(opts[i],i,true));
    const items=el.querySelectorAll('.pk-item');
    function upd(){const ci=Math.round(el.scrollTop/ih);items.forEach((it,idx)=>{if(idx===ci){it.classList.add('active');val=it.dataset.value;if(val!==lastVal){lastVal=val;Haptic.tick();Sound.tick();onSelect(val)}}else it.classList.remove('active')})}
    function scr(){if(scrolling)return;const st=el.scrollTop;if(st<(cl-1)*ih){scrolling=true;el.scrollTop=st+cnt*ih;setTimeout(()=>scrolling=false,50)}else if(st>(cl+cnt-1)*ih){scrolling=true;el.scrollTop=st-cnt*ih;setTimeout(()=>scrolling=false,50)}upd()}
    el.addEventListener('scroll',scr);
    items.forEach(it=>{it.addEventListener('click',()=>{Haptic.light();Sound.click();el.scrollTo({top:(cl+parseInt(it.dataset.ri))*ih,behavior:'smooth'})})});
    el.style.padding=Math.floor((el.parentElement.clientHeight-ih)/2)+'px 0';
    setTimeout(()=>{el.scrollTop=(cl+defIdx)*ih;upd()},60);
    return()=>val;
}

// ===== TABS =====
document.querySelectorAll('.cat').forEach(tab=>{tab.addEventListener('click',()=>{Haptic.medium();Sound.select();document.querySelectorAll('.cat').forEach(t=>t.classList.remove('active'));tab.classList.add('active');curCat=tab.dataset.cat;rebuildMethod()})});
function rebuildMethod(){const keys=CATS[curCat],opts=keys.map(k=>({value:k,label:G[k].name}));selMethod=opts[0].value;updateDesc();createPicker('methodPicker',opts,0,v=>{selMethod=v;updateDesc()})}
function updateDesc(){const d=document.getElementById('mDesc');if(G[selMethod])d.textContent=G[selMethod].desc}
const setCounts=[];for(let i=1;i<=10;i++)setCounts.push({value:i,label:i+'세트'});
createPicker('setCountPicker',setCounts,4,v=>selSets=parseInt(v));
rebuildMethod();

// ===== GENERATE =====
const genBtn=document.getElementById('genBtn');
const resArea=document.getElementById('resArea');
genBtn.addEventListener('click',generate);

function generate(){
    const gen=G[selMethod];if(!gen)return;
    Sound.generate();Haptic.heavy();
    const ct=document.getElementById('resScroll');
    const rng=n=>n<=10?'1':n<=20?'2':n<=30?'3':n<=40?'4':'5';

    // 결과 영역 표시
    resArea.classList.remove('empty');
    resArea.classList.add('has-results');

    for(let s=1;s<=selSets;s++){
        const nums=gen.fn().sort((a,b)=>a-b);
        const el=document.createElement('div');
        el.className='set';el.style.animationDelay=(s-1)*.08+'s';
        el.innerHTML=`<div class="set-top"><strong>${s}세트</strong><span class="tag">${gen.name}</span></div><div class="balls">${nums.map((n,i)=>`<span class="b" data-range="${rng(n)}" style="animation-delay:${(s-1)*.08+i*.07}s">${n}</span>`).join('')}</div>`;
        ct.insertBefore(el,ct.firstChild);
        nums.forEach((_,i)=>Sound.ballPop(i+(s-1)*6));
    }
    ct.scrollTop=0;
    Confetti.fire(40+selSets*8);
    genBtn.textContent='생성 완료!';genBtn.classList.add('done','shimmer');
    setTimeout(()=>Sound.success(),300);setTimeout(()=>Haptic.success(),300);
    setTimeout(()=>{genBtn.textContent='번호 생성';genBtn.classList.remove('done','shimmer')},900);
}

// ===== CLEAR =====
document.getElementById('clrBtn').addEventListener('click',()=>{
    Haptic.light();Sound.clear();
    document.getElementById('resScroll').innerHTML='';
    resArea.classList.remove('has-results');
    resArea.classList.add('empty');
});

// ===== INIT AUDIO =====
document.addEventListener('touchstart',function i(){try{const c=new(AudioContext||webkitAudioContext),b=c.createBuffer(1,1,22050),s=c.createBufferSource();s.buffer=b;s.connect(c.destination);s.start(0)}catch(e){}document.removeEventListener('touchstart',i)},{once:true});
</script>
</body>
</html>
